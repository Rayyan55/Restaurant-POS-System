<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customer Order</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
    <div class="card shadow-sm">
        <div class="card-body">
            <h2 class="card-title mb-4">Place Your Order</h2>

            <form id="orderForm">
                <div class="mb-3">
                    <label class="form-label">Select Menu Items:</label>
                    <div id="menuItems" class="row g-2"></div>
                </div>
                <button type="submit" class="btn btn-primary">Place Order</button>
            </form>
        </div>
    </div>
</div>

<script>
    let selectedItems = [];

    function loadMenu() {
        fetch("api/get_menu.php")
            .then(res => res.json())
            .then(data => {
                const container = document.getElementById("menuItems");
                container.innerHTML = "";
                data.forEach(item => {
                    const col = document.createElement("div");
                    col.className = "col-md-4";

                    const card = document.createElement("div");
                    card.className = "card p-2 h-100";

                    const checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.className = "form-check-input me-2";
                    checkbox.value = item.name;
                    checkbox.onchange = function () {
                        if (this.checked) {
                            selectedItems.push(this.value);
                        } else {
                            selectedItems = selectedItems.filter(i => i !== this.value);
                        }
                    };

                    const label = document.createElement("label");
                    label.className = "form-check-label";
                    label.textContent = `${item.name} ($${item.price})`;

                    const wrapper = document.createElement("div");
                    wrapper.className = "form-check";
                    wrapper.appendChild(checkbox);
                    wrapper.appendChild(label);

                    card.appendChild(wrapper);
                    col.appendChild(card);
                    container.appendChild(col);
                });
            });
    }

    document.getElementById("orderForm").addEventListener("submit", function (e) {
        e.preventDefault();

        if (selectedItems.length === 0) {
            alert("Please select at least one item.");
            return;
        }

        fetch("api/place_order.php", {
            method: "POST",
            body: JSON.stringify({ items: selectedItems }),
            headers: { "Content-Type": "application/json" }
        })
            .then(res => res.json())
            .then(data => {
                alert("Order Placed! Your order number is " + data.order_id);
                selectedItems = [];
                loadMenu(); // reset
            });
    });

    loadMenu();
</script>

</body>
</html>
